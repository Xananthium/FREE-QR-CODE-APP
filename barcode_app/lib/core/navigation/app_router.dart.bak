import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'routes.dart';
import '../../screens/home_screen.dart';
import '../../screens/url_generator_screen.dart';
import '../../screens/wifi_generator_screen.dart';
import '../../screens/customize_screen.dart';
import '../../screens/export/export_screen.dart';
import '../../screens/error_screen.dart';

/// Global router configuration for the application.
///
/// This uses GoRouter for declarative routing with support for:
/// - Type-safe navigation
/// - Deep linking
/// - Browser URL updates (web)
/// - Error handling
final GoRouter appRouter = GoRouter(
  initialLocation: AppRoutes.home,
  debugLogDiagnostics: true,
  routes: [
    GoRoute(
      path: AppRoutes.home,
      name: AppRoutes.homeName,
      builder: (context, state) => const HomeScreen(),
    ),
    GoRoute(
      path: AppRoutes.urlGenerator,
      name: AppRoutes.urlGeneratorName,
      builder: (context, state) => const UrlGeneratorScreen(),
    ),
    GoRoute(
      path: AppRoutes.wifiGenerator,
      name: AppRoutes.wifiGeneratorName,
      builder: (context, state) => const WifiGeneratorScreen(),
    ),
    GoRoute(
      path: AppRoutes.customize,
      name: AppRoutes.customizeName,
      builder: (context, state) => const CustomizeScreen(),
    ),
    GoRoute(
      path: AppRoutes.exportScreen,
      name: AppRoutes.exportName,
      builder: (context, state) => const ExportScreen(),
    ),
  ],
  errorBuilder: (context, state) => ErrorScreen(
    error: state.error?.toString() ?? 'Unknown error',
    path: state.uri.toString(),
  ),
);

/// Extension methods on BuildContext for type-safe navigation.
///
/// These helper methods make navigation cleaner and prevent typos in route names.
/// Usage: context.goToUrlGenerator() instead of context.go('/url-generator')
extension NavigationExtension on BuildContext {
  /// Navigate to home screen
  void goToHome() => go(AppRoutes.home);

  /// Navigate to URL generator screen
  void goToUrlGenerator() => go(AppRoutes.urlGenerator);

  /// Navigate to WiFi generator screen
  void goToWifiGenerator() => go(AppRoutes.wifiGenerator);

  /// Navigate to customize screen
  void goToCustomize() => go(AppRoutes.customize);

  /// Navigate to export screen
  void goToExport() => go(AppRoutes.exportScreen);

  /// Navigate back if possible, otherwise go to home
  void goBackOrHome() {
    if (canPop()) {
      pop();
    } else {
      go(AppRoutes.home);
    }
  }

  /// Check if the current location matches a route
  bool isCurrentRoute(String route) {
    final routerState = GoRouter.of(this).routerDelegate.currentConfiguration;
    return routerState.uri.path == route;
  }

  /// Get the current route path
  String get currentRoute {
    final routerState = GoRouter.of(this).routerDelegate.currentConfiguration;
    return routerState.uri.path;
  }
}

/// Extension methods on GoRouter for additional navigation utilities
extension GoRouterExtension on GoRouter {
  /// Navigate to home screen
  void goToHome() => go(AppRoutes.home);

  /// Navigate to URL generator screen
  void goToUrlGenerator() => go(AppRoutes.urlGenerator);

  /// Navigate to WiFi generator screen
  void goToWifiGenerator() => go(AppRoutes.wifiGenerator);

  /// Navigate to customize screen
  void goToCustomize() => go(AppRoutes.customize);

  /// Navigate to export screen
  void goToExport() => go(AppRoutes.exportScreen);
}
